import{u as q}from"./user-XRSNCG8L.js";import{g as z,c as R}from"./user-D9452C-O.js";import{a as y}from"./common-DR-T8v4v.js";import{s as n}from"./request-vRFKru4k.js";import{_ as F,r as i,u as M,D as x,j as D,b as o,o as b,c as G,e,w as a,f as d,a as _,E as T,i as U,n as $,g as H,G as J}from"./index-CJd5nHo2.js";const K={class:"profile-container"},L=["src"],O="http://127.0.0.1:8000/upload/user/avatar",P={__name:"ChangeAvatar",setup(Q){const p=q(),w=i(0),f=i(null),u=i(null),m=i([]);M();const r=x({avatar:""}),k=x({avatar:[{required:!0,message:"请上传头像",trigger:"blur"}]});D(()=>{z().then(t=>{r.username=t.data.username,w.value=t.data.id}).catch(t=>{n("error","获取原始用户信息失败")})});const C=t=>{t.validate(l=>{if(!l)return!1;R(r).then(s=>{n("success","修改头像成功!"),p.userInfo.avatar=s.data.avatar}).catch(s=>{n("error",s.message)})})};function E(t){m.value.push(t.avatar),r.avatar=t.avatar,n("success","头像上传成功")}function A(t){n("error","头像上传失败")}const B=t=>{u.value.clearFiles();const l=t[0];l.uid=J(),u.value.handleStart(l),u.value.submit()};return(t,l)=>{const s=o("el-avatar"),c=o("el-col"),I=o("el-icon"),N=o("el-upload"),v=o("el-form-item"),g=o("el-row"),S=o("el-button"),V=o("el-form"),j=o("el-card");return b(),G("div",K,[e(j,null,{default:a(()=>[e(g,{gutter:10},{default:a(()=>[e(c,{span:6},{default:a(()=>[e(s,{src:d(y)(d(p).userInfo.avatar),size:200,shape:"square"},null,8,["src"])]),_:1}),e(c,{span:18},{default:a(()=>[_("div",null,[e(V,{ref_key:"formRef",ref:f,model:r,rules:k,style:{"max-width":"100%"},"label-width":"auto","label-position":"left"},{default:a(()=>[e(g,null,{default:a(()=>[e(c,{span:12,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:a(()=>[e(v,{style:{"margin-top":"10px"},prop:"avatar",label:"头像"},{default:a(()=>[e(N,{ref_key:"upload",ref:u,action:O,"list-type":"picture-card","auto-upload":!0,"show-file-list":!0,"v-model":m.value,limit:1,onSuccess:E,onError:A,onExceed:B,accept:"image/*"},{file:a(({file:h})=>[_("div",null,[_("img",{class:"el-upload-list__item-thumbnail",src:h.url,alt:""},null,8,L)])]),default:a(()=>[e(I,null,{default:a(()=>[e(d(T))]),_:1})]),_:1},8,["v-model"])]),_:1})]),_:1}),r.avatar!==""?(b(),U(c,{key:0,span:12,style:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"}},{default:a(()=>[l[1]||(l[1]=_("div",null,"预览",-1)),e(s,{src:d(y)(r.avatar),size:160,shape:"square"},null,8,["src"])]),_:1})):$("",!0)]),_:1}),e(v,{style:{"margin-top":"100px"},type:"submit"},{default:a(()=>[e(S,{type:"primary",onClick:l[0]||(l[0]=h=>C(f.value)),plain:"",style:{width:"100%"},size:"large",round:""},{default:a(()=>l[2]||(l[2]=[H("更新头像 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1})]),_:1})])}}},ae=F(P,[["__scopeId","data-v-17fb131d"]]);export{ae as default};
