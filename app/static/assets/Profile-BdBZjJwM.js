import{u as I}from"./user-XRSNCG8L.js";import{g as q,u as z}from"./user-D9452C-O.js";import{a as B}from"./common-DR-T8v4v.js";import{s as i}from"./request-vRFKru4k.js";import{_ as C,r as f,u as N,D as g,j as P,b as o,o as R,c as U,e,w as r,f as n,a as M,g as T,q as j}from"./index-CJd5nHo2.js";const A={class:"profile-container"},D={__name:"Profile",setup(E){const u=I(),c=f(0),d=f(null),v=N(),s=g({username:""}),b=g({username:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:1,max:20,message:"用户名称长度必须在1到20之间",trigger:"blur"}]});P(()=>{q().then(a=>{s.username=a.data.username,c.value=a.data.id}).catch(a=>{i("error","获取原始用户信息失败")})});const x=a=>{a.validate(t=>{if(!t)return!1;let m={user_id:c.value,username:s.username};z(m).then(l=>{i("success","修改用户名成功, 请重新登陆!"),j(),v.push("/auth/login")}).catch(l=>{i("error",l.message)})})};return(a,t)=>{const m=o("el-avatar"),l=o("el-col"),h=o("el-input"),_=o("el-form-item"),w=o("el-button"),y=o("el-form"),V=o("el-row"),k=o("el-card");return R(),U("div",A,[e(k,null,{default:r(()=>[e(V,{gutter:10},{default:r(()=>[e(l,{span:6},{default:r(()=>[e(m,{src:n(B)(n(u).userInfo.avatar),size:200,shape:"square"},null,8,["src"])]),_:1}),e(l,{span:18},{default:r(()=>[M("div",null,[e(y,{ref_key:"formRef",ref:d,model:s,rules:b,style:{"max-width":"100%"},"label-width":"auto","label-position":"left"},{default:r(()=>[e(_,{style:{"margin-top":"10px"},prop:"username",label:"用户名称"},{default:r(()=>[e(h,{modelValue:s.username,"onUpdate:modelValue":t[0]||(t[0]=p=>s.username=p),class:"w-50 m-2",disabled:n(u).userInfo.username==="root",placeholder:"用户名称",size:"large",type:"text"},null,8,["modelValue","disabled"])]),_:1}),e(_,{style:{"margin-top":"100px"},type:"submit"},{default:r(()=>[e(w,{type:"primary",onClick:t[1]||(t[1]=p=>x(d.value)),disabled:n(u).userInfo.username==="root",plain:"",style:{width:"100%"},size:"large",round:""},{default:r(()=>t[2]||(t[2]=[T("更新用户名 ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1})]),_:1})])}}},J=C(D,[["__scopeId","data-v-8c22c8b8"]]);export{J as default};
