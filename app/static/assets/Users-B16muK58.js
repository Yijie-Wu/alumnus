import{b as Y,d as Z,e as ee}from"./user-D9452C-O.js";import{u as te}from"./user-C4c4RE7V.js";import{s as d}from"./request-vRFKru4k.js";import{a as D}from"./common-DR-T8v4v.js";import{u as le,g as ae}from"./role-DG0K_Lgs.js";import{_ as oe,r as u,j as re,D as S,b as r,o as b,c as F,a as f,e as t,w as a,f as c,F as $,g,t as ne,h as se,E as de,G as ue,i as ie}from"./index-CJd5nHo2.js";const ce={class:"datas-container"},pe=["src"],me="http://127.0.0.1:8000/upload/user/avatar",_e={__name:"Users",setup(fe){const p=te(),h=u(""),m=u(!1),x=u({}),y=u(null),i=u(null),w=u([]),V=u(0),U=le(),q=window.innerHeight-20;re(()=>{Y().then(o=>{p.setUsers(o.data)}).catch(o=>{d("error","获取用户列表失败")}),ae().then(o=>{U.setRoles(o.data)}).catch(o=>{d("error","获取角色列表失败")})});const s=S({avatar:"",username:"",role_id:""}),z=S({avatar:[{required:!0,message:"请上传头像",trigger:"blur"}],username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:1,max:20,message:"用户名长度必须在1到20之间",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"blur"}]}),B=(o,e)=>{m.value=!0,x.value=e,s.avatar=e.avatar,s.username=e.username,s.role_id=e.role_id,V.value=e.id},R=(o,e)=>{Z(e.id).then(n=>{d("success","用户删除成功"),p.removeUser(e.id)}).catch(n=>{d("error","用户删除失败")})};function j(o){w.value.push(o.avatar),s.avatar=o.avatar,d("success","头像上传成功")}function A(o){d("error","头像上传失败")}const I=o=>{i.value.clearFiles();const e=o[0];e.uid=ue(),i.value.handleStart(e),i.value.submit()},N=()=>{i.value.clearFiles()},H=o=>{o.validate(e=>{if(!e)return!1;ee(V.value,s).then(n=>{d("success","修改用户信息成功!"),p.updateUser(n.data),m.value=!1}).catch(n=>{d("error",n.message)})})};return(o,e)=>{const n=r("el-table-column"),M=r("el-tag"),k=r("el-avatar"),C=r("el-input"),v=r("el-button"),G=r("el-popconfirm"),L=r("el-table"),T=r("el-option"),J=r("el-select"),_=r("el-form-item"),E=r("el-col"),K=r("el-icon"),O=r("el-upload"),P=r("el-row"),Q=r("el-form"),W=r("el-dialog");return b(),F($,null,[f("div",ce,[t(L,{data:c(p).users,style:{width:"100%"},border:"",height:q},{default:a(()=>[t(n,{label:"用户编号",prop:"id",align:"center",fixed:"left",width:"100"}),t(n,{label:"用户名称",prop:"username",align:"center",width:"200",fixed:"left"}),t(n,{label:"用户角色",prop:"role",align:"center",width:"160"},{default:a(({row:l})=>[t(M,{type:"success",round:""},{default:a(()=>[g(ne(l.role),1)]),_:2},1024)]),_:1}),t(n,{label:"用户头像",prop:"avatar",align:"center",width:"100"},{default:a(({row:l})=>[t(k,{size:50,src:c(D)(l.avatar),shape:"circle"},null,8,["src"])]),_:1}),t(n,{label:"创建时间",prop:"created_at",align:"center",width:"240"}),t(n,{label:"更新时间",prop:"updated_at",align:"center",width:"240"}),t(n,{align:"center",fixed:"right",width:"240"},{header:a(()=>[t(C,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),placeholder:"搜索用户"},null,8,["modelValue"])]),default:a(l=>[t(v,{type:"warning",round:"",disabled:l.row.username==="root",onClick:X=>B(l.$index,l.row)},{default:a(()=>e[5]||(e[5]=[g("编辑")])),_:2},1032,["disabled","onClick"]),t(G,{title:"确定要删除吗?","confirm-button-text":"确定","cancel-button-text":"取消",width:"300"},{reference:a(()=>[t(v,{type:"danger",round:"",disabled:l.row.role==="超级管理员",onClick:X=>R(l.$index,l.row)},{default:a(()=>e[6]||(e[6]=[g("删除")])),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),t(W,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value=l),title:"修改用户信息",width:"75%",onClosed:N},{default:a(()=>[t(Q,{ref_key:"formRef",ref:y,model:s,rules:z,style:{"max-width":"100%"},"label-width":"auto","label-position":"left"},{default:a(()=>[t(_,{style:{"margin-top":"20px"},prop:"role_id",label:"用户角色"},{default:a(()=>[t(J,{modelValue:s.role_id,"onUpdate:modelValue":e[1]||(e[1]=l=>s.role_id=l),style:{width:"200px"}},{default:a(()=>[(b(!0),F($,null,se(c(U).roles,l=>(b(),ie(T,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{style:{"margin-top":"10px"},prop:"username",label:"用户名"},{default:a(()=>[t(C,{modelValue:s.username,"onUpdate:modelValue":e[2]||(e[2]=l=>s.username=l),class:"w-50 m-2",placeholder:"用户名",size:"large",type:"text",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),t(P,null,{default:a(()=>[t(E,{span:6,style:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"}},{default:a(()=>[t(k,{src:c(D)(x.value.avatar),size:150,shape:"square"},null,8,["src"]),e[7]||(e[7]=f("div",null,"现有头像",-1))]),_:1}),t(E,{span:12,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:a(()=>[t(_,{style:{"margin-top":"10px"},prop:"avatar",label:"头像"},{default:a(()=>[t(O,{ref_key:"upload",ref:i,action:me,"list-type":"picture-card","auto-upload":!0,"show-file-list":!0,"v-model":w.value,limit:1,onSuccess:j,onError:A,onExceed:I,accept:"image/*"},{file:a(({file:l})=>[f("div",null,[f("img",{class:"el-upload-list__item-thumbnail",src:l.url,alt:""},null,8,pe)])]),default:a(()=>[t(K,null,{default:a(()=>[t(c(de))]),_:1})]),_:1},8,["v-model"])]),_:1})]),_:1})]),_:1}),t(_,{style:{"margin-top":"100px"},type:"submit"},{default:a(()=>[t(v,{type:"primary",onClick:e[3]||(e[3]=l=>H(y.value)),plain:"",style:{width:"100%"},size:"large",round:""},{default:a(()=>e[8]||(e[8]=[g("更新用户信息 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}},we=oe(_e,[["__scopeId","data-v-a42579a1"]]);export{we as default};
